//@version=6
strategy(
     "NQ Open Strategy", 
     overlay=true, 
     initial_capital=100000, 
     default_qty_type=strategy.fixed, 
     default_qty_value=1, 
     currency=currency.USD,
     process_orders_on_close=true // ensures order executes at the end of the 9:29 bar
 )

// user rule: always use lowercase when writing comments

// timezone for new york
nyTz = "America/New_York"

// inputs
lookbackYears = input.int(10, "lookback years", minval=1)
usePercent    = input.bool(true, "use 1% equity sizing? (may result in 0 trades if capital is low)", group="sizing")
minOne        = input.bool(true, "force minimum 1 contract", group="sizing")

// calculate start date
startTime = timestamp(year(timenow) - lookbackYears, month(timenow), dayofmonth(timenow), 0, 0)
withinTimeRange = time >= startTime

// entry and exit time conditions
isEntryTime = hour(time, nyTz) == 9 and minute(time, nyTz) == 29
isExitTime = hour(time, nyTz) == 10 and minute(time, nyTz) == 0

// quantity calculation
float qty = 1.0
if usePercent
    // calculate 1% of equity
    targetCash = strategy.equity * 0.01
    // calculate contract notional value
    contractValue = close * syminfo.pointvalue
    qty := targetCash / contractValue
    
    // round down to nearest whole contract, but allow min 1 if toggled
    qty := math.floor(qty)
    if minOne and qty < 1
        qty := 1

// strategy logic
if withinTimeRange
    // enter long at end of 9:29 am est bar
    if isEntryTime
        strategy.entry("long", strategy.long, qty=qty, comment="entry before open")
    
    // exit position at end of 10:00 am est bar
    if isExitTime
        strategy.close_all(comment="exit at 10:00 am")

// visual aids
bg_color = isEntryTime ? color.new(color.green, 85) : isExitTime ? color.new(color.red, 85) : na
bgcolor(bg_color)
